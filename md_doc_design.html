<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>YACLib: Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">YACLib
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">C++ library for concurrent tasks execution</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_doc_design.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Design </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md27"></a>
Rationale</h1>
<p ><b>YACLib</b> is a lightweight C++ library for concurrent and parallel task execution, that is striving to satisfy the following properties:</p>
<ul>
<li>Zero cost abstractions</li>
<li>Easy to use</li>
<li>Easy to build</li>
<li>Good test coverage</li>
</ul>
<h2><a class="anchor" id="autotoc_md28"></a>
Zero cost abstraction</h2>
<p >The abstractions that YACLib provides should make the code optimally written for the particular case, easier and keep it just as fast.</p>
<p >For example, the creation and execution of a pipeline from a <code><a class="el" href="classyaclib_1_1Future.html" title="Provides a mechanism to access the result of async operations.">yaclib::Future</a></code> makes at most one allocation for each step of the pipeline.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Easy to use</h2>
<p >Programming concurrent and parallel programs is difficult, therefore one of the most important goals is to make <b>YACLib</b> easy to use correctly.</p>
<p >Example:</p>
<p ><code>Future</code> in our interface has two <code>Get</code> overloads:</p>
<ul>
<li><code>ReturnValue Get() const &amp;</code></li>
<li><code>ReturnValue Get() &amp;&amp;</code></li>
</ul>
<p >and other overloads have been removed.</p>
<p >As a consequence, most of the incorrect or suboptimal use of <code>Get</code> is discovered at compile time.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Easy to build</h2>
<p >Building the YACLib should be simple, as otherwise it is difficult to add the library to cross-platform projects. However, the build should not significantly slow down the build of the target project. Therefore, we build the entire project using CMake as a static library, trying to use a minimum of public boilerplate code.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Good test coverage</h2>
<p >The most important thing is the absence of bugs. Because it is very difficult to find a multi-threaded bug, and if it is in the library, it is still more difficult. That's why we:</p>
<ul>
<li>100% line coverage and strive to 100% branch coverage</li>
<li>Testing the code on multiple platforms with different build flags</li>
<li>We use static analyzers for C++, such as clang-tidy, cppcheck</li>
<li>We use dynamic analyzers for C++, such as Google Sanitizers, Valgrind, etc</li>
</ul>
<h1><a class="anchor" id="autotoc_md32"></a>
Why should I use YACLib instead of ... ?</h1>
<h2><a class="anchor" id="autotoc_md33"></a>
std</h2>
<p ><code>future</code>, <code>promise</code> and <code>packaged_task</code> are not zero-cost abstractions. For example, to protect result from data race, <code>future</code> uses a mutex instead of a wait-free state machine. Such an overhead is due to the specific API requirements in the C++ standard. Also std does not have callbacks for <code>future</code>, therefore there is no possibility of their combination.</p>
<h2><a class="anchor" id="autotoc_md34"></a>
OpenMP</h2>
<p >Good library for data-based parallelism. Allows you to quickly parallelize computational tasks, but OpenMP is not suitable for concurrent task execution, which is more common in production.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
oneTBB</h2>
<p >This library is a newer and well-written alternative to OpenMP, but it is very big and has a difficult API for concurrent task execution. Also, some <a href="https://github.com/oneapi-src/oneTBB/blob/master/include/oneapi/tbb/spin_mutex.h#L71">code</a> of this library does not optimally use the C++ memory model and cache coherence protocol.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Boost.Asio</h2>
<p >Good library for network platform-specific API. The main drawback is that CPU-bound thread-pool and other task-based parallelism primitives (<code>strand</code>) are implemented like stubs.</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Folly</h2>
<p >This library has a good user-friendly API, but it is large and very difficuilt to build. Also our library is <a href="https://github.com/YACLib/Bench">faster than</a> Folly.</p>
<h2><a class="anchor" id="autotoc_md38"></a>
HPX</h2>
<p >This library is as big as Folly, but unlike it, Futures are implemented inefficiently, since HPX tries to satisfy the requirements of the C++ standard.</p>
<h2><a class="anchor" id="autotoc_md39"></a>
Boost.Fiber and Marl</h2>
<p >Both libraries provide only user-level threads (fibers), but this is not the only thing that is needed in the library for concurrent and parallel task execution. In particular, fibers are not always suitable for CPU-bound tasks and for handle asynchronous callbacks from external libraries.</p>
<h2><a class="anchor" id="autotoc_md40"></a>
Taskflow</h2>
<p >It seems that the priority of the library is data-based parallelism by CUDA and OpenCL, but not concurrent task execution. For example, this library uses <code>std::future</code> in CPU-bound thread-pool, and also there is no possibility in this library to use custom abstractions for a thread.</p>
<h2><a class="anchor" id="autotoc_md42"></a>
libunifex and cppcoro</h2>
<p >Both libraries are quite interesting, but experimental. They require C++20 coroutine support. At the moment, libunifex looks like a proposal, but not as a production ready library. Perhaps it will be ready in C++26, but our library even supports C++17.</p>
<p ><em>If you have any thoughts on improving YACLib, feel free to create a Github issue</em> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
<script type="text/javascript">
  $(document).ready(function(){
    toggleButton = document.createElement('doxygen-awesome-dark-mode-toggle')
    toggleButton.title = "Toggle Light/Dark Mode"
    document.getElementById("MSearchBox").parentNode.appendChild(toggleButton)
  })
</script>
</body>
</html>
